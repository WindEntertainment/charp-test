name: Build logger
description: Build logger

runs:
  using: 'composite'
  steps:
    - name: Prepare logger env
      uses: ./.github/workflows/modules/logger/setup-env

    - name: Build logger with wm
      shell: bash
      run: |
        export CC=${{ env.cc }}
        export CXX=${{ env.cxx }}

        wm run cmake-build -t logger -bt ${{ env.engineBuildType }}
        wm run cpack-build -bt ${{ env.engineBuildType }}

    # - name: Upload package as artifact
    #   # wrong if condition
    #   if: ${{ env.isRelease == 'false' }}
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: ${{ env.artifact }}
    #     path: ${{ env.projectRoot }}/dreich/releases/dreich
    #     retention-days: 1
    #     overwrite: true

    - name: Upload package as release
      if: ${{ env.isRelease == true }}
      shell: bash
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        gh release delete $sha --yes || echo "No existing release to delete"
        gh release create $sha --title "Release $sha" --generate-notes --latest $(pwd)/releases/logger.zip
